name: Python Tests

on:
  workflow_dispatch:
#   push:
#     branches: [ main, master ]
#   pull_request:
#     branches: [ main, master ]

jobs:
  test:
    name: Test on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [macos-latest] #[ubuntu-latest, windows-latest]
        python-version: ["3.11"]

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -e ".[test,dev]"

    - name: Build Test Service
      run: |
        python tests/test_service/build_test_service.py

    - name: Run Tests
      # Linux systemd tests might fail on standard GitHub runners due to lack of systemd --user.
      # We attempt to run them, but users might need a self-hosted runner or specific setup for systemd.
      run: |
        pytest tests/ -v
      env:
        # Increase generic timeouts if needed for CI
        CI: true
